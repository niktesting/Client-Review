<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asset Management Console</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #2b5876, #4e4376);
      margin: 0;
      padding: 20px;
      color: white;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .card {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      transition: transform 0.3s ease-in-out;
    }
    .card:hover {
      transform: scale(1.02);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid rgba(255,255,255,0.3);
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      border-radius: 6px;
      border: none;
    }
    button {
      cursor: pointer;
      background: #00c6ff;
      color: black;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #0072ff;
      color: white;
    }
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>üìä Asset Management Console</h1>

  <div class="container">
    <!-- Add Asset -->
    <div class="card">
      <h2>Add Asset</h2>
      <input type="text" id="assetName" placeholder="Asset Name"><br>
      <select id="assetType">
        <option value="Mobile">Mobile</option>
        <option value="Laptop">Laptop</option>
        <option value="PC">PC</option>
        <option value="Firewall">Firewall</option>
        <option value="AP">AP</option>
      </select><br>
      <input type="number" id="assetQty" placeholder="Quantity"><br>
      <button onclick="addAsset()">Add Asset</button>

      <h3>Assets List</h3>
      <table>
        <thead>
          <tr><th>Name</th><th>Type</th><th>Qty</th><th>Action</th></tr>
        </thead>
        <tbody id="assetTable"></tbody>
      </table>
    </div>

    <!-- Handover -->
    <div class="card">
      <h2>Handover Asset</h2>
      <select id="handoverAsset"></select><br>
      <input type="text" id="handoverPerson" placeholder="Person Name"><br>
      <input type="number" id="handoverQty" placeholder="Quantity"><br>
      <button onclick="handoverAsset()">Handover</button>

      <h3>Handover List</h3>
      <table>
        <thead>
          <tr><th>Asset</th><th>Person</th><th>Qty</th><th>Date</th></tr>
        </thead>
        <tbody id="handoverTable"></tbody>
      </table>
    </div>

    <!-- Charts -->
    <div class="card">
      <h2>üìä Stock Distribution</h2>
      <canvas id="stockChart"></canvas>
    </div>
    <div class="card">
      <h2>üìä Handover Distribution</h2>
      <canvas id="handoverChart"></canvas>
    </div>
  </div>

  <div style="text-align:center; margin-top:20px;">
    <button onclick="exportExcel()">üì• Export Excel</button>
    <button onclick="resetAll()"> üóëÔ∏è Reset All Data</button>
  </div>


  <script>
    function resetAll() {
  if (!confirm("This will delete ALL data. Continue?")) return;
  assets = [];
  handovers = [];
  nextAssetId = 1;
  localStorage.removeItem("assets");
  localStorage.removeItem("handovers");
  localStorage.removeItem("nextAssetId");
  renderAssets();
  renderHandovers();
  alert("All data cleared!");
}

    let assets = JSON.parse(localStorage.getItem("assets") || "[]");
    let handovers = JSON.parse(localStorage.getItem("handovers") || "[]");

    function saveData() {
      localStorage.setItem("assets", JSON.stringify(assets));
      localStorage.setItem("handovers", JSON.stringify(handovers));
    }

    function renderAssets() {
      const table = document.getElementById("assetTable");
      const select = document.getElementById("handoverAsset");
      table.innerHTML = "";
      select.innerHTML = "";

      assets.forEach((a, index) => {
        table.innerHTML += `<tr>
          <td>${a.name}</td>
          <td>${a.type}</td>
          <td>${a.qty}</td>
          <td><button onclick="deleteAsset(${index})">‚ùå</button></td>
        </tr>`;
        if (a.qty > 0) {
          select.innerHTML += `<option value="${a.name}">${a.name} (${a.qty})</option>`;
        }
      });

      updateCharts();
    }

    function renderHandovers() {
      const table = document.getElementById("handoverTable");
      table.innerHTML = "";
      handovers.forEach(h => {
        table.innerHTML += `<tr>
          <td>${h.asset}</td>
          <td>${h.person}</td>
          <td>${h.qty}</td>
          <td>${h.date}</td>
        </tr>`;
      });
      updateCharts();
    }

    function addAsset() {
      const name = document.getElementById("assetName").value;
      const type = document.getElementById("assetType").value;
      const qty = parseInt(document.getElementById("assetQty").value);
      if (!name || qty <= 0) return alert("Enter valid details");
      assets.push({ name, type, qty });
      saveData();
      renderAssets();
    }

    function deleteAsset(index) {
      assets.splice(index, 1);
      saveData();
      renderAssets();
    }

    function handoverAsset() {
      const assetName = document.getElementById("handoverAsset").value;
      const person = document.getElementById("handoverPerson").value;
      const qty = parseInt(document.getElementById("handoverQty").value);

      let asset = assets.find(a => a.name === assetName);
      if (!asset || qty <= 0 || qty > asset.qty) return alert("Invalid quantity");

      asset.qty -= qty;
      handovers.push({ asset: assetName, person, qty, date: new Date().toLocaleString() });

      saveData();
      renderAssets();
      renderHandovers();
    }

    // PIE CHARTS
    let stockChart, handoverChart;
    function updateCharts() {
      const ctx1 = document.getElementById("stockChart").getContext("2d");
      const ctx2 = document.getElementById("handoverChart").getContext("2d");

      if (stockChart) stockChart.destroy();
      if (handoverChart) handoverChart.destroy();

      stockChart = new Chart(ctx1, {
        type: 'pie',
        data: {
          labels: assets.map(a => a.name),
          datasets: [{
            data: assets.map(a => a.qty),
            backgroundColor: ["#ff6384","#36a2eb","#ffcd56","#4bc0c0","#9966ff"]
          }]
        }
      });

      handoverChart = new Chart(ctx2, {
        type: 'pie',
        data: {
          labels: handovers.map(h => h.asset + " ‚Üí " + h.person),
          datasets: [{
            data: handovers.map(h => h.qty),
            backgroundColor: ["#ff9f40","#ff6384","#36a2eb","#4bc0c0","#9966ff"]
          }]
        }
      });
    }
// Global variable to auto-increment asset ID
let nextAssetId = JSON.parse(localStorage.getItem("nextAssetId") || "1");

// Add Asset
function addAsset() {
  const name = document.getElementById("assetName").value.trim();
  const type = document.getElementById("assetType").value;
  const qty = parseInt(document.getElementById("assetQty").value);
  if (!name || qty <= 0) return alert("Enter valid details");

  assets.push({ id: nextAssetId++, name, type, qty });
  localStorage.setItem("nextAssetId", JSON.stringify(nextAssetId));
  saveData();
  renderAssets();
}

// Export to Excel with separate sheets
function exportExcel() {
  const wb = XLSX.utils.book_new();

  // Stock Sheet
  const stockData = assets.map(a => ({ ID: a.id, Name: a.name, Type: a.type, Quantity: a.qty }));
  const wsStock = XLSX.utils.json_to_sheet(stockData);
  XLSX.utils.book_append_sheet(wb, wsStock, "Stock");

  // Handover Sheet
  const handoverData = handovers.map((h, index) => ({
    ID: index + 1,
    Asset: h.asset,
    Person: h.person,
    Quantity: h.qty,
    Date: h.date
  }));
  const wsHandover = XLSX.utils.json_to_sheet(handoverData);
  XLSX.utils.book_append_sheet(wb, wsHandover, "Handover");

  // Save Excel
  XLSX.writeFile(wb, "Asset_Management.xlsx");
}

    renderAssets();
    renderHandovers();
  </script>
</body>
</html>
